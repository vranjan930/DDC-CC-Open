<script>
function classify(subjects = [], title = "") {
  let text = (subjects.join(" ") + " " + title).toLowerCase();

  // ---- DDC RULES (BASIC, EXTENSIBLE) ----
  let ddc = "Not determined";
  let ddcNote = "";

  if (text.includes("library") || text.includes("information science")) {
    ddc = "020.1";
    ddcNote = "Library science â€“ theory and principles";
  } else if (text.includes("information retrieval")) {
    ddc = "025.04";
    ddcNote = "Information storage and retrieval";
  } else if (text.includes("computer")) {
    ddc = "004";
    ddcNote = "Computer science";
  } else if (text.includes("education")) {
    ddc = "370";
    ddcNote = "Education";
  }

  // ---- COLON CLASSIFICATION (PMEST â€“ SIMPLIFIED) ----
  let cc = "Not determined";
  let ccNote = "";

  if (text.includes("library")) {
    cc = "2;44";
    ccNote = "P: Library Science | E: Principles";
  } else if (text.includes("information retrieval")) {
    cc = "2;7";
    ccNote = "P: Library Science | E: Retrieval processes";
  }

  return { ddc, ddcNote, cc, ccNote };
}

async function searchBook() {
  const q = document.getElementById("query").value.trim();
  const status = document.getElementById("status");
  const result = document.getElementById("result");

  if (!q) {
    status.innerText = "Please enter ISBN, Title, or Author.";
    return;
  }

  status.innerText = "Searching Open Library...";
  result.innerHTML = "";

  let url = "";

  if (/^[0-9Xx-]{10,17}$/.test(q)) {
    url = "https://openlibrary.org/api/books?bibkeys=ISBN:" + q + "&format=json&jscmd=data";
  } else {
    url = "https://openlibrary.org/search.json?q=" + encodeURIComponent(q);
  }

  const response = await fetch(url);
  const data = await response.json();

  if (Object.keys(data).length === 0 || data.docs?.length === 0) {
    status.innerText = "No data found.";
    return;
  }

  let book = {};

  if (data.docs) {
    book.title = data.docs[0].title;
    book.author = data.docs[0].author_name?.[0];
    book.subjects = data.docs[0].subject || [];
  } else {
    const key = Object.keys(data)[0];
    book.title = data[key].title;
    book.author = data[key].authors?.[0]?.name;
    book.subjects = data[key].subjects || [];
  }

  let cls = classify(book.subjects, book.title);

  status.innerText = "Result found:";

  result.innerHTML = `
    <h3>${book.title || "N/A"}</h3>
    <p><strong>Author:</strong> ${book.author || "N/A"}</p>
    <p><strong>Subjects:</strong> ${book.subjects.slice(0,5).join(", ") || "N/A"}</p>

    <hr>
    <h4>ðŸ“˜ Dewey Decimal Classification (Suggested)</h4>
    <p><strong>${cls.ddc}</strong> â€” ${cls.ddcNote}</p>

    <h4>ðŸ“— Colon Classification (Suggested)</h4>
    <p><strong>${cls.cc}</strong> â€” ${cls.ccNote}</p>

    <p><em>Note: Class numbers are generated using transparent rule-based subject analysis.</em></p>
  `;
}
</script>
